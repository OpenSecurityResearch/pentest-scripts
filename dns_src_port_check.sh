#!/bin/bash

echo "Quick and dirty DNS source port checker"
echo "By brad a."
echo "----------------------------------------"

if [[ $1 == "" ]]; then
	echo "You Must provide a DNS Server to test"
else
	if [[ $2 == "-n" ]]; then
		echo "Nessus Checks:"
		echo -e "$1 (or its upstream server) uses the following source ports (if they are the same its bad)\n"
		for i in {1..4}
		do
			RANDOM=`perl -le "print map { (a..z)[rand 26] } 1..8"`
			#RANDOM=lodhgwfs0
			dig @$1 +short $RANDOM.t.nessus.org TXT
		done
		echo -e "\nbe sure to compare $1 with the output above, if its the upstream server then you have to check to see if that server is in scope"	
		echo "----------------------------------------"
	fi
	echo "DNS-OARC Test:"
	
	dig @$1 +short porttest.dns-oarc.net TXT
	echo -e "\n\n"
	echo "If the output above says POOR theres a problem"
	echo "if it doesnt say anything it may not be responding or vuln!"
	echo "see https://www.dns-oarc.net/oarc/services/porttest"
fi
